import*as utils from"../utils/color_utils";import*as math from"../utils/math_utils";import{ViewingConditions}from"./viewing_conditions";class Cam16{constructor(t,a,i,s,h,n,o,r,M){this.hue=t,this.chroma=a,this.j=i,this.q=s,this.m=h,this.s=n,this.jstar=o,this.astar=r,this.bstar=M}distance(t){var a=this.jstar-t.jstar,i=this.astar-t.astar,t=this.bstar-t.bstar,a=Math.sqrt(a*a+i*i+t*t);return 1.41*Math.pow(a,.63)}static fromInt(t){return Cam16.fromIntInViewingConditions(t,ViewingConditions.DEFAULT)}static fromIntInViewingConditions(t,a){var i=(65280&t)>>8,s=255&t,t=utils.linearized((16711680&t)>>16),i=utils.linearized(i),s=utils.linearized(s),h=.41233895*t+.35762064*i+.18051042*s,n=.2126*t+.7152*i+.0722*s,t=.01932141*t+.11916382*i+.95034478*s,i=a.rgbD[0]*(.401288*h+.650173*n-.051461*t),s=a.rgbD[1]*(-.250268*h+1.204414*n+.045854*t),h=a.rgbD[2]*(-.002079*h+.048952*n+.953127*t),n=Math.pow(a.fl*Math.abs(i)/100,.42),t=Math.pow(a.fl*Math.abs(s)/100,.42),o=Math.pow(a.fl*Math.abs(h)/100,.42),i=400*math.signum(i)*n/(n+27.13),n=400*math.signum(s)*t/(t+27.13),s=400*math.signum(h)*o/(o+27.13),t=(11*i+-12*n+s)/11,h=(i+n-2*s)/9,o=(20*i+20*n+21*s)/20,i=(40*i+20*n+s)/20,n=180*Math.atan2(h,t)/Math.PI,s=n<0?360+n:360<=n?n-360:n,n=s*Math.PI/180,i=i*a.nbb,i=100*Math.pow(i/a.aw,a.c*a.z),r=4/a.c*Math.sqrt(i/100)*(a.aw+4)*a.fLRoot,t=5e4/13*(.25*(Math.cos((s<20.14?360+s:s)*Math.PI/180+2)+3.8))*a.nc*a.ncb*Math.sqrt(t*t+h*h)/(.305+o),h=Math.pow(t,.9)*Math.pow(1.64-Math.pow(.29,a.n),.73),o=h*Math.sqrt(i/100),t=o*a.fLRoot,h=50*Math.sqrt(h*a.c/(a.aw+4)),a=(1+100*.007)*i/(1+.007*i),M=1/.0228*Math.log(1+.0228*t),m=M*Math.cos(n),M=M*Math.sin(n);return new Cam16(s,o,i,r,t,h,a,m,M)}static fromJch(t,a,i){return Cam16.fromJchInViewingConditions(t,a,i,ViewingConditions.DEFAULT)}static fromJchInViewingConditions(t,a,i,s){var h=4/s.c*Math.sqrt(t/100)*(s.aw+4)*s.fLRoot,n=a*s.fLRoot,o=a/Math.sqrt(t/100),o=50*Math.sqrt(o*s.c/(s.aw+4)),s=i*Math.PI/180,r=(1+100*.007)*t/(1+.007*t),M=1/.0228*Math.log(1+.0228*n),m=M*Math.cos(s),M=M*Math.sin(s);return new Cam16(i,a,t,h,n,o,r,m,M)}static fromUcs(t,a,i){return Cam16.fromUcsInViewingConditions(t,a,i,ViewingConditions.DEFAULT)}static fromUcsInViewingConditions(t,a,i,s){var h=Math.sqrt(a*a+i*i),h=(Math.exp(.0228*h)-1)/.0228/s.fLRoot;let n=Math.atan2(i,a)*(180/Math.PI);n<0&&(n+=360);i=t/(1-.007*(t-100));return Cam16.fromJchInViewingConditions(i,h,n,s)}toInt(){return this.viewed(ViewingConditions.DEFAULT)}viewed(t){var a=0===this.chroma||0===this.j?0:this.chroma/Math.sqrt(this.j/100),a=Math.pow(a/Math.pow(1.64-Math.pow(.29,t.n),.73),1/.9),i=this.hue*Math.PI/180,s=.25*(Math.cos(2+i)+3.8),h=t.aw*Math.pow(this.j/100,1/t.c/t.z),s=5e4/13*s*t.nc*t.ncb,h=h/t.nbb,n=Math.sin(i),i=Math.cos(i),s=23*(.305+h)*a/(23*s+11*a*i+108*a*n),a=s*i,i=s*n,s=(460*h+451*a+288*i)/1403,n=(460*h-891*a-261*i)/1403,h=(460*h-220*a-6300*i)/1403,a=Math.max(0,27.13*Math.abs(s)/(400-Math.abs(s))),i=math.signum(s)*(100/t.fl)*Math.pow(a,1/.42),s=Math.max(0,27.13*Math.abs(n)/(400-Math.abs(n))),a=math.signum(n)*(100/t.fl)*Math.pow(s,1/.42),n=Math.max(0,27.13*Math.abs(h)/(400-Math.abs(h))),s=math.signum(h)*(100/t.fl)*Math.pow(n,1/.42),h=i/t.rgbD[0],n=a/t.rgbD[1],i=s/t.rgbD[2];return utils.argbFromXyz(1.86206786*h-1.01125463*n+.14918677*i,.38752654*h+.62144744*n-.00897398*i,-.0158415*h-.03412294*n+1.04996444*i)}}export{Cam16};